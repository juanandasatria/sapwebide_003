/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["jquery.sap.global"],function(q){"use strict";var m={_aRequestedKeys:null,_sEntryFound:null,_aKeys:null,_oEntitySet:null,convertDueToDispatch:function(){return{method:"POST",path:new RegExp("I_MaintOrderOperationTPSetdispatch(\\?(.*))?"),response:function(x,u){var t=this;var r=m._getAllMockEntriesforEntitySet.call(t,"C_RSHOrdersAndOperations");if(!r.success||!r.data.d.results[1]){x.respond(404);}var s=decodeURIComponent(u);s=s.substring(1);var d={};var k=s.split("&");k.forEach(function(c){var f=c.split("=");d[f[0]]=f[1];});var a=d.MaintenanceOrder.replace("'","");a=a.slice(0,-1);var b=d.MaintenanceOrderOperation.replace("'","");b=b.slice(0,-1);var e;if(a==="4018843"&&b==="0011"){e=r.data.d.results[1];}else if(a==="4018843"&&b==="0020"){e=r.data.d.results[2];}else if(a==="4018843"&&b==="0050"){e=r.data.d.results[5];}else if(a==="4018843"&&b==="0060"){e=r.data.d.results[6];}else if(a==="4018843"&&b==="0070"){e=r.data.d.results[7];}else if(a==="4018843"&&b==="0080"){e=r.data.d.results[8];}else{x.respond(404);}var K="ID='"+e.ID+"'";var M=m._getSingleEntity.call(this,"C_RSHOrdersAndOperations",K);if(M.entry.ProcessingStatus!==40){M.entry.ProcessingStatus=30;M.entry.ProcessingStatusText="Dispatched";}x.respondJSON(200,{},JSON.stringify({d:M}));return true;}};},convertDispatchToDue:function(){return{method:"POST",path:new RegExp("I_MaintOrderOperationTPUnsetdispatch(\\?(.*))?"),response:function(x,u){var t=this;var r=m._getAllMockEntriesforEntitySet.call(t,"C_RSHOrdersAndOperations",x,u);if(!r.success||!r.data.d.results[0]){x.respond(404);}var s=decodeURIComponent(u);s=s.substring(1);var d={};var k=s.split("&");k.forEach(function(c){var f=c.split("=");d[f[0]]=f[1];});var a=d.MaintenanceOrder.replace("'","");a=a.slice(0,-1);var b=d.MaintenanceOrderOperation.replace("'","");b=b.slice(0,-1);var e;if(a==="4018843"&&b==="0011"){e=r.data.d.results[1];}else if(a==="4018843"&&b==="0020"){e=r.data.d.results[2];}else if(a==="4018843"&&b==="0060"){e=r.data.d.results[6];}else if(a==="4018843"&&b==="0090"){e=r.data.d.results[9];}else{x.respond(404);}var K="ID='"+e.ID+"'";var M=m._getSingleEntity.call(this,"C_RSHOrdersAndOperations",K);if(M.entry.ProcessingStatus!==40){M.entry.ProcessingStatus=20;M.entry.ProcessingStatusText="Due";}x.respondJSON(200,{},JSON.stringify({d:M}));return true;}};},triggerWorkCenterOperationMassChange:function(){return{method:"POST",path:new RegExp("I_MaintOrderOperationTPChangeassgmt(\\?(.*))?"),response:function(x,u){var t=this;var r=m._getAllMockEntriesforEntitySet.call(t,"C_RSHOrdersAndOperations",x,u);if(!r.success||!r.data.d.results[1]){x.respond(404);}var s=decodeURIComponent(u);s=s.substring(1);var d={};var k=s.split("&");k.forEach(function(c){var f=c.split("=");d[f[0]]=f[1];});var a=d.MaintenanceOrder.replace("'","");a=a.slice(0,-1);var b=d.MaintenanceOrderOperation.replace("'","");b=b.slice(0,-1);var e;if(a==="4018843"&&b==="0011"){e=r.data.d.results[1];}else if(a==="4018843"&&b==="0020"){e=r.data.d.results[2];}else{x.respond(404);}var K="ID='"+e.ID+"'";var M=m._getSingleEntity.call(this,"C_RSHOrdersAndOperations",K);M.entry.MainWorkCenter="WorkCenter 2";x.respondJSON(200,{},JSON.stringify({d:M}));return true;}};},triggerChangeScheduling:function(){return{method:"POST",path:new RegExp("I_MaintOrderOperationTPChangescheduling(\\?(.*))?"),response:function(x,u){var t=this;var h={};var r=m._getAllMockEntriesforEntitySet.call(t,"C_RSHOrdersAndOperations",x,u);if(!r.success||!r.data.d.results[1]){x.respond(404);}if(u.includes("Schedulingstartconstraint='%20'")){var s=decodeURIComponent(u);s=s.substring(1);var d={};var k=s.split("&");k.forEach(function(c){var f=c.split("=");d[f[0]]=f[1];});var a=d.MaintenanceOrder.replace("'","");a=a.slice(0,-1);var b=d.MaintenanceOrderOperation.replace("'","");b=b.slice(0,-1);var e;if(a==="4018843"&&b==="0070"){e=r.data.d.results[7];}else if(a==="4018843"&&b==="0090"){e=r.data.d.results[9];}else{x.respond(404);}var K="ID='"+e.ID+"'";var M=m._getSingleEntity.call(this,"C_RSHOrdersAndOperations",K);if(M.entry.OpBscStartDateConstraintType==="1"){M.entry.OpBscStartDateConstraintType="";M.entry.OrderOpStartConstraintDateTime=null;}}else{e=r.data.d.results[1];K="ID='"+e.ID+"'";M=m._getSingleEntity.call(this,"C_RSHOrdersAndOperations",K);M.entry.PlannedStartDate=m._convertToJSONDate(new Date());if(!this.bMessageReturned){var o={"code":"RSH_LVLING_CONFLICTS/"+Math.floor(Math.random()*100)+1,"message":"Test message to check message manager","severity":"success","target":"/#TRANSIENT#","details":[]};h={"sap-message":JSON.stringify(o)};this.bMessageReturned=true;}}x.respondJSON(200,h,JSON.stringify({d:M}));return true;}};},_convertToJSONDate:function(d){var n=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()));return"/Date("+n.getTime()+")/";},_getAllMockEntriesforEntitySet:function(E){var r={success:false,data:{d:{results:[]}}};try{var d=this._oMockdata[E];var f={results:q.extend(true,[],d)};r.success=true;r.data.d=f;}catch(e){r.success=false;}return r;},_getSingleEntity:function(e,_){this._aRequestedKeys=null;this._sEntryFound=null;this._aKeys=null;this._oEntitySet=null;var t=this;var k=_;k=decodeURIComponent(k);this._oEntitySet=t._mEntitySets[e];this._aKeys=this._oEntitySet.keys;this._aRequestedKeys=k.split(",");if(this._aRequestedKeys.length!==this._aKeys.length){t._logAndThrowMockServerCustomError(400,t._oErrorMessages.INVALID_KEY_PREDICATE_QUANTITY);}t._isRequestedKeysValid(this._oEntitySet,this._aRequestedKeys);if(this._aRequestedKeys.length===1&&!this._aRequestedKeys[0].split("=")[1]){this._aRequestedKeys=[this._aKeys[0]+"="+this._aRequestedKeys[0]];}return m._getEntitySetByKeys(t._oMockdata[e],this._aRequestedKeys,this._aKeys,this._oEntitySet,t._trim,t);},_getEntitySetByKeys:function(M,r,k,e,t){var a=this;for(var j=0;j<M.length;j++){for(var i=0;i<r.length;i++){var K=r[i].split("=");var s=t(K[0]);if(q.inArray(s,k)===-1){return true;}var n=t(K[1]);var o=M[j][s];switch(e.keysType[s]){case"Edm.String":n=n.replace(/^\'|\'$/g,"");break;case"Edm.DateTime":o=a._getDateTime(o);break;case"Edm.SByte":if(!a._isValidNumber(n)){return false;}n=parseFloat(n);break;case"Edm.Guid":n=n.replace(/^guid\'|\'$/g,"");break;case"Edm.Boolean":if(["true","false"].indexOf(n)===-1){a._logAndThrowMockServerCustomError(400,a._oErrorMessages.INVALID_KEY_TYPE,s);}n=n==="true";break;default:n=n;}if(o===n){this._sEntryFound=true;break;}else{this._sEntryFound=false;}}if(this._sEntryFound===true){break;}}if(this._sEntryFound){this._oFoundEntry={index:j,entry:M[j]};return this._oFoundEntry;}else{return false;}},createRelationships:function(){return{method:"POST",path:new RegExp("(C_RSHOperationRelationships)(\\(([^/\\?#]+)\\)/?(.*)?)?"),response:function(x,e){var t=this;var r=JSON.parse(x.requestBody);var R=m._createNewRelationshipEntry(r,e,t);x.respondJSON(R.iResult,R.oRespondHeader,R.sResponseText);return true;}};},_createNewRelationshipEntry:function(r,e,c){var R={};var _={};R.__metadata={};_.id="C_RSHOperationRelationships(PredecessorOrder='"+r.MaintenanceOrder+"',PredecessorOrderOperation='"+r.MaintenanceOrderOperation+"',SuccessorOrder='"+r.RelatedMaintenanceOrder+"',SuccessorOrderOperation='"+r.RelatedMaintOrderOperation+"')";_.uri=_.id;_.type="RSH_EAM_ORDER_GANTT_SRV.C_RSHOperationRelationshipsType";R.__metadata=_;R.NetworkActivityRelationType=m._getExternalRelationshipType(r.OrderOpRelationshipIntType);var d=m._isRelationshipPresent(c._oMockdata[e],R.__metadata.id,R.NetworkActivityRelationType);var o={};o.oRespondHeader={};o.sResponseText={};var M={};if(d){o.iResult=400;M={"error":{"code":"CN/824","message":"Relationship from "+r.MaintenanceOrder+" "+r.MaintenanceOrderOperation+" to "+r.RelatedMaintenanceOrder+" "+r.RelatedMaintOrderOperation+" already exists","target":"","severity":"error","transition":true,"details":[]}};o.oRespondHeader={"Content-Type":"application/json;charset=utf-8"};o.sResponseText=JSON.stringify(M);return o;}M={"code":"IW/080","message":"Order saved with number "+r.MaintenanceOrder,"target":"","severity":"success","transition":true,"details":[]};o.iResult=201;o.oRespondHeader={"Content-Type":"application/json;charset=utf-8","sap-message":JSON.stringify(M)};R.PredecessorOrder=r.MaintenanceOrder;R.PredecessorOrderOperation=r.MaintenanceOrderOperation;R.SuccessorOrder=r.RelatedMaintenanceOrder;R.SuccessorOrderOperation=r.RelatedMaintOrderOperation;R.RelationshipIsExplicit="X";R.PredecessorOrderOperationRowID="00000"+r.MaintenanceOrder+r.MaintenanceOrderOperation;R.SuccessorOrderOperationRowID="00000"+r.RelatedMaintenanceOrder+r.RelatedMaintOrderOperation;c._oMockdata[e]=c._oMockdata[e].concat(R);o.sResponseText=JSON.stringify({d:R});return o;},_isRelationshipPresent:function(M,s,r){for(var i=0;i<M.length;i++){if(M[i].__metadata.id.indexOf(s)!==-1&&M[i].NetworkActivityRelationType===r){return true;}}return false;},_getExternalRelationshipType:function(r){switch(r){case"NF":return"FinishToStart";case"AF":return"StartToStart";case"EF":return"FinishToFinish";case"SF":return"StartToFinish";default:return" ";}},getRequests:function(r,t){this.addRequest(r,this.convertDueToDispatch(),t);this.addRequest(r,this.convertDispatchToDue(),t);this.addRequest(r,this.triggerWorkCenterOperationMassChange(),t);this.addRequest(r,this.triggerChangeScheduling(),t);this.addRequest(r,this.createRelationships(),t);return r;},addRequest:function(r,c,t){var R=r.find(function(i){return i.path.toString()===c.path.toString();});if(R){R.response=c.response.bind(t);}else{R=c;R.response=c.response.bind(t);r.push(R);}}};return m;},true);
